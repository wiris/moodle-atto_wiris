if (typeof __coverage__ === 'undefined') { __coverage__ = {}; }
if (!__coverage__['build/moodle-atto_wiris-button/moodle-atto_wiris-button.js']) {
   __coverage__['build/moodle-atto_wiris-button/moodle-atto_wiris-button.js'] = {"path":"build/moodle-atto_wiris-button/moodle-atto_wiris-button.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":36},"end":{"line":1,"column":55}}},"2":{"name":"(anonymous_2)","line":38,"loc":{"start":{"line":38,"column":17},"end":{"line":38,"column":34}}},"3":{"name":"(anonymous_3)","line":45,"loc":{"start":{"line":45,"column":95},"end":{"line":45,"column":109}}},"4":{"name":"(anonymous_4)","line":54,"loc":{"start":{"line":54,"column":38},"end":{"line":54,"column":75}}},"5":{"name":"(anonymous_5)","line":66,"loc":{"start":{"line":66,"column":52},"end":{"line":66,"column":63}}},"6":{"name":"(anonymous_6)","line":74,"loc":{"start":{"line":74,"column":56},"end":{"line":74,"column":67}}},"7":{"name":"(anonymous_7)","line":84,"loc":{"start":{"line":84,"column":63},"end":{"line":84,"column":88}}},"8":{"name":"(anonymous_8)","line":97,"loc":{"start":{"line":97,"column":58},"end":{"line":97,"column":75}}},"9":{"name":"(anonymous_9)","line":110,"loc":{"start":{"line":110,"column":61},"end":{"line":110,"column":72}}},"10":{"name":"(anonymous_10)","line":124,"loc":{"start":{"line":124,"column":57},"end":{"line":124,"column":68}}},"11":{"name":"(anonymous_11)","line":136,"loc":{"start":{"line":136,"column":59},"end":{"line":136,"column":70}}},"12":{"name":"(anonymous_12)","line":147,"loc":{"start":{"line":147,"column":51},"end":{"line":147,"column":62}}},"13":{"name":"(anonymous_13)","line":163,"loc":{"start":{"line":163,"column":62},"end":{"line":163,"column":80}}},"14":{"name":"(anonymous_14)","line":246,"loc":{"start":{"line":246,"column":41},"end":{"line":246,"column":53}}},"15":{"name":"(anonymous_15)","line":260,"loc":{"start":{"line":260,"column":34},"end":{"line":260,"column":45}}},"16":{"name":"(anonymous_16)","line":275,"loc":{"start":{"line":275,"column":30},"end":{"line":275,"column":55}}},"17":{"name":"(anonymous_17)","line":292,"loc":{"start":{"line":292,"column":29},"end":{"line":292,"column":47}}},"18":{"name":"(anonymous_18)","line":334,"loc":{"start":{"line":334,"column":17},"end":{"line":334,"column":34}}},"19":{"name":"(anonymous_19)","line":357,"loc":{"start":{"line":357,"column":19},"end":{"line":357,"column":30}}},"20":{"name":"(anonymous_20)","line":366,"loc":{"start":{"line":366,"column":17},"end":{"line":366,"column":28}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":375,"column":68}},"2":{"start":{"line":36,"column":0},"end":{"line":372,"column":3}},"3":{"start":{"line":41,"column":8},"end":{"line":43,"column":9}},"4":{"start":{"line":42,"column":12},"end":{"line":42,"column":19}},"5":{"start":{"line":45,"column":8},"end":{"line":236,"column":22}},"6":{"start":{"line":46,"column":12},"end":{"line":235,"column":13}},"7":{"start":{"line":54,"column":16},"end":{"line":57,"column":18}},"8":{"start":{"line":55,"column":20},"end":{"line":55,"column":88}},"9":{"start":{"line":56,"column":20},"end":{"line":56,"column":68}},"10":{"start":{"line":59,"column":16},"end":{"line":59,"column":130}},"11":{"start":{"line":66,"column":16},"end":{"line":68,"column":18}},"12":{"start":{"line":67,"column":20},"end":{"line":67,"column":76}},"13":{"start":{"line":74,"column":16},"end":{"line":76,"column":18}},"14":{"start":{"line":75,"column":20},"end":{"line":75,"column":44}},"15":{"start":{"line":84,"column":16},"end":{"line":90,"column":18}},"16":{"start":{"line":85,"column":20},"end":{"line":85,"column":84}},"17":{"start":{"line":86,"column":20},"end":{"line":89,"column":21}},"18":{"start":{"line":87,"column":24},"end":{"line":87,"column":48}},"19":{"start":{"line":88,"column":24},"end":{"line":88,"column":109}},"20":{"start":{"line":97,"column":16},"end":{"line":104,"column":18}},"21":{"start":{"line":98,"column":20},"end":{"line":98,"column":92}},"22":{"start":{"line":99,"column":20},"end":{"line":99,"column":61}},"23":{"start":{"line":100,"column":20},"end":{"line":100,"column":58}},"24":{"start":{"line":101,"column":20},"end":{"line":101,"column":120}},"25":{"start":{"line":102,"column":20},"end":{"line":102,"column":54}},"26":{"start":{"line":103,"column":20},"end":{"line":103,"column":52}},"27":{"start":{"line":110,"column":16},"end":{"line":119,"column":18}},"28":{"start":{"line":111,"column":20},"end":{"line":111,"column":87}},"29":{"start":{"line":112,"column":20},"end":{"line":112,"column":40}},"30":{"start":{"line":114,"column":20},"end":{"line":114,"column":87}},"31":{"start":{"line":116,"column":20},"end":{"line":118,"column":21}},"32":{"start":{"line":117,"column":24},"end":{"line":117,"column":61}},"33":{"start":{"line":124,"column":16},"end":{"line":131,"column":18}},"34":{"start":{"line":125,"column":20},"end":{"line":125,"column":61}},"35":{"start":{"line":126,"column":20},"end":{"line":126,"column":60}},"36":{"start":{"line":128,"column":20},"end":{"line":128,"column":80}},"37":{"start":{"line":129,"column":20},"end":{"line":129,"column":55}},"38":{"start":{"line":130,"column":20},"end":{"line":130,"column":52}},"39":{"start":{"line":136,"column":16},"end":{"line":141,"column":18}},"40":{"start":{"line":137,"column":20},"end":{"line":137,"column":61}},"41":{"start":{"line":138,"column":20},"end":{"line":138,"column":58}},"42":{"start":{"line":139,"column":20},"end":{"line":139,"column":120}},"43":{"start":{"line":140,"column":20},"end":{"line":140,"column":54}},"44":{"start":{"line":147,"column":16},"end":{"line":156,"column":18}},"45":{"start":{"line":148,"column":20},"end":{"line":148,"column":61}},"46":{"start":{"line":151,"column":20},"end":{"line":151,"column":60}},"47":{"start":{"line":153,"column":20},"end":{"line":155,"column":21}},"48":{"start":{"line":154,"column":24},"end":{"line":154,"column":124}},"49":{"start":{"line":163,"column":16},"end":{"line":196,"column":18}},"50":{"start":{"line":164,"column":19},"end":{"line":164,"column":35}},"51":{"start":{"line":165,"column":19},"end":{"line":165,"column":46}},"52":{"start":{"line":166,"column":19},"end":{"line":166,"column":46}},"53":{"start":{"line":167,"column":19},"end":{"line":167,"column":61}},"54":{"start":{"line":168,"column":19},"end":{"line":168,"column":31}},"55":{"start":{"line":169,"column":19},"end":{"line":193,"column":20}},"56":{"start":{"line":170,"column":23},"end":{"line":170,"column":63}},"57":{"start":{"line":172,"column":23},"end":{"line":172,"column":117}},"58":{"start":{"line":173,"column":23},"end":{"line":173,"column":64}},"59":{"start":{"line":175,"column":23},"end":{"line":183,"column":24}},"60":{"start":{"line":176,"column":27},"end":{"line":176,"column":52}},"61":{"start":{"line":177,"column":30},"end":{"line":183,"column":24}},"62":{"start":{"line":180,"column":27},"end":{"line":180,"column":63}},"63":{"start":{"line":182,"column":27},"end":{"line":182,"column":52}},"64":{"start":{"line":185,"column":23},"end":{"line":190,"column":24}},"65":{"start":{"line":186,"column":27},"end":{"line":186,"column":70}},"66":{"start":{"line":187,"column":27},"end":{"line":187,"column":78}},"67":{"start":{"line":189,"column":27},"end":{"line":189,"column":67}},"68":{"start":{"line":192,"column":23},"end":{"line":192,"column":66}},"69":{"start":{"line":194,"column":19},"end":{"line":194,"column":68}},"70":{"start":{"line":195,"column":19},"end":{"line":195,"column":33}},"71":{"start":{"line":208,"column":16},"end":{"line":208,"column":52}},"72":{"start":{"line":209,"column":16},"end":{"line":209,"column":130}},"73":{"start":{"line":210,"column":16},"end":{"line":210,"column":63}},"74":{"start":{"line":211,"column":16},"end":{"line":211,"column":89}},"75":{"start":{"line":212,"column":16},"end":{"line":212,"column":59}},"76":{"start":{"line":213,"column":16},"end":{"line":213,"column":59}},"77":{"start":{"line":214,"column":16},"end":{"line":214,"column":63}},"78":{"start":{"line":215,"column":16},"end":{"line":215,"column":60}},"79":{"start":{"line":216,"column":16},"end":{"line":216,"column":71}},"80":{"start":{"line":217,"column":16},"end":{"line":217,"column":86}},"81":{"start":{"line":218,"column":16},"end":{"line":218,"column":90}},"82":{"start":{"line":221,"column":16},"end":{"line":221,"column":94}},"83":{"start":{"line":222,"column":16},"end":{"line":222,"column":47}},"84":{"start":{"line":224,"column":16},"end":{"line":224,"column":76}},"85":{"start":{"line":227,"column":16},"end":{"line":227,"column":70}},"86":{"start":{"line":231,"column":16},"end":{"line":231,"column":44}},"87":{"start":{"line":232,"column":16},"end":{"line":234,"column":17}},"88":{"start":{"line":233,"column":20},"end":{"line":233,"column":97}},"89":{"start":{"line":238,"column":8},"end":{"line":238,"column":33}},"90":{"start":{"line":241,"column":8},"end":{"line":241,"column":36}},"91":{"start":{"line":246,"column":8},"end":{"line":253,"column":11}},"92":{"start":{"line":248,"column":12},"end":{"line":252,"column":13}},"93":{"start":{"line":249,"column":16},"end":{"line":249,"column":56}},"94":{"start":{"line":250,"column":16},"end":{"line":250,"column":99}},"95":{"start":{"line":251,"column":16},"end":{"line":251,"column":51}},"96":{"start":{"line":259,"column":8},"end":{"line":259,"column":64}},"97":{"start":{"line":260,"column":8},"end":{"line":268,"column":10}},"98":{"start":{"line":261,"column":12},"end":{"line":261,"column":44}},"99":{"start":{"line":262,"column":12},"end":{"line":262,"column":52}},"100":{"start":{"line":263,"column":12},"end":{"line":266,"column":13}},"101":{"start":{"line":264,"column":16},"end":{"line":264,"column":99}},"102":{"start":{"line":267,"column":12},"end":{"line":267,"column":47}},"103":{"start":{"line":274,"column":8},"end":{"line":274,"column":56}},"104":{"start":{"line":275,"column":8},"end":{"line":284,"column":10}},"105":{"start":{"line":276,"column":12},"end":{"line":276,"column":40}},"106":{"start":{"line":277,"column":12},"end":{"line":277,"column":51}},"107":{"start":{"line":278,"column":12},"end":{"line":282,"column":13}},"108":{"start":{"line":279,"column":16},"end":{"line":279,"column":59}},"109":{"start":{"line":280,"column":16},"end":{"line":280,"column":65}},"110":{"start":{"line":283,"column":12},"end":{"line":283,"column":46}},"111":{"start":{"line":292,"column":8},"end":{"line":327,"column":10}},"112":{"start":{"line":293,"column":12},"end":{"line":293,"column":28}},"113":{"start":{"line":294,"column":12},"end":{"line":294,"column":39}},"114":{"start":{"line":295,"column":12},"end":{"line":295,"column":39}},"115":{"start":{"line":296,"column":12},"end":{"line":296,"column":54}},"116":{"start":{"line":297,"column":12},"end":{"line":297,"column":24}},"117":{"start":{"line":299,"column":12},"end":{"line":323,"column":13}},"118":{"start":{"line":300,"column":16},"end":{"line":300,"column":56}},"119":{"start":{"line":302,"column":15},"end":{"line":302,"column":109}},"120":{"start":{"line":303,"column":16},"end":{"line":303,"column":57}},"121":{"start":{"line":305,"column":16},"end":{"line":313,"column":17}},"122":{"start":{"line":306,"column":20},"end":{"line":306,"column":45}},"123":{"start":{"line":307,"column":23},"end":{"line":313,"column":17}},"124":{"start":{"line":310,"column":20},"end":{"line":310,"column":56}},"125":{"start":{"line":312,"column":20},"end":{"line":312,"column":45}},"126":{"start":{"line":315,"column":16},"end":{"line":320,"column":17}},"127":{"start":{"line":316,"column":20},"end":{"line":316,"column":63}},"128":{"start":{"line":317,"column":20},"end":{"line":317,"column":71}},"129":{"start":{"line":319,"column":20},"end":{"line":319,"column":60}},"130":{"start":{"line":322,"column":16},"end":{"line":322,"column":59}},"131":{"start":{"line":325,"column":12},"end":{"line":325,"column":61}},"132":{"start":{"line":326,"column":12},"end":{"line":326,"column":26}},"133":{"start":{"line":335,"column":8},"end":{"line":343,"column":9}},"134":{"start":{"line":336,"column":12},"end":{"line":342,"column":15}},"135":{"start":{"line":344,"column":8},"end":{"line":352,"column":9}},"136":{"start":{"line":345,"column":12},"end":{"line":351,"column":15}},"137":{"start":{"line":358,"column":8},"end":{"line":358,"column":56}},"138":{"start":{"line":359,"column":8},"end":{"line":359,"column":84}},"139":{"start":{"line":360,"column":8},"end":{"line":360,"column":70}},"140":{"start":{"line":361,"column":8},"end":{"line":361,"column":59}},"141":{"start":{"line":367,"column":8},"end":{"line":367,"column":56}},"142":{"start":{"line":368,"column":8},"end":{"line":368,"column":84}},"143":{"start":{"line":369,"column":8},"end":{"line":369,"column":85}},"144":{"start":{"line":370,"column":8},"end":{"line":370,"column":59}}},"branchMap":{"1":{"line":41,"type":"if","locations":[{"start":{"line":41,"column":8},"end":{"line":41,"column":8}},{"start":{"line":41,"column":8},"end":{"line":41,"column":8}}]},"2":{"line":46,"type":"if","locations":[{"start":{"line":46,"column":12},"end":{"line":46,"column":12}},{"start":{"line":46,"column":12},"end":{"line":46,"column":12}}]},"3":{"line":59,"type":"binary-expr","locations":[{"start":{"line":59,"column":58},"end":{"line":59,"column":86}},{"start":{"line":59,"column":90},"end":{"line":59,"column":128}}]},"4":{"line":86,"type":"if","locations":[{"start":{"line":86,"column":20},"end":{"line":86,"column":20}},{"start":{"line":86,"column":20},"end":{"line":86,"column":20}}]},"5":{"line":116,"type":"if","locations":[{"start":{"line":116,"column":20},"end":{"line":116,"column":20}},{"start":{"line":116,"column":20},"end":{"line":116,"column":20}}]},"6":{"line":153,"type":"if","locations":[{"start":{"line":153,"column":20},"end":{"line":153,"column":20}},{"start":{"line":153,"column":20},"end":{"line":153,"column":20}}]},"7":{"line":153,"type":"binary-expr","locations":[{"start":{"line":153,"column":24},"end":{"line":153,"column":50}},{"start":{"line":153,"column":54},"end":{"line":153,"column":80}},{"start":{"line":153,"column":84},"end":{"line":153,"column":107}}]},"8":{"line":175,"type":"if","locations":[{"start":{"line":175,"column":23},"end":{"line":175,"column":23}},{"start":{"line":175,"column":23},"end":{"line":175,"column":23}}]},"9":{"line":177,"type":"if","locations":[{"start":{"line":177,"column":30},"end":{"line":177,"column":30}},{"start":{"line":177,"column":30},"end":{"line":177,"column":30}}]},"10":{"line":185,"type":"if","locations":[{"start":{"line":185,"column":23},"end":{"line":185,"column":23}},{"start":{"line":185,"column":23},"end":{"line":185,"column":23}}]},"11":{"line":185,"type":"binary-expr","locations":[{"start":{"line":185,"column":27},"end":{"line":185,"column":82}},{"start":{"line":185,"column":86},"end":{"line":185,"column":112}}]},"12":{"line":232,"type":"if","locations":[{"start":{"line":232,"column":16},"end":{"line":232,"column":16}},{"start":{"line":232,"column":16},"end":{"line":232,"column":16}}]},"13":{"line":248,"type":"if","locations":[{"start":{"line":248,"column":12},"end":{"line":248,"column":12}},{"start":{"line":248,"column":12},"end":{"line":248,"column":12}}]},"14":{"line":305,"type":"if","locations":[{"start":{"line":305,"column":16},"end":{"line":305,"column":16}},{"start":{"line":305,"column":16},"end":{"line":305,"column":16}}]},"15":{"line":307,"type":"if","locations":[{"start":{"line":307,"column":23},"end":{"line":307,"column":23}},{"start":{"line":307,"column":23},"end":{"line":307,"column":23}}]},"16":{"line":315,"type":"if","locations":[{"start":{"line":315,"column":16},"end":{"line":315,"column":16}},{"start":{"line":315,"column":16},"end":{"line":315,"column":16}}]},"17":{"line":315,"type":"binary-expr","locations":[{"start":{"line":315,"column":20},"end":{"line":315,"column":75}},{"start":{"line":315,"column":79},"end":{"line":315,"column":105}}]},"18":{"line":335,"type":"if","locations":[{"start":{"line":335,"column":8},"end":{"line":335,"column":8}},{"start":{"line":335,"column":8},"end":{"line":335,"column":8}}]},"19":{"line":344,"type":"if","locations":[{"start":{"line":344,"column":8},"end":{"line":344,"column":8}},{"start":{"line":344,"column":8},"end":{"line":344,"column":8}}]}},"code":["(function () { YUI.add('moodle-atto_wiris-button', function (Y, NAME) {","","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","//","","/*"," * @package    atto_atto_wiris"," * @copyright  2011, Maths for More S.L. http://www.wiris.com/?utm_source=npmjs&utm_medium=referral"," * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */","","/**"," * @module moodle-atto_atto_wiris-button"," */","","/**"," * MathType for Atto plugin."," *"," * @namespace M.atto_wiris"," * @class button"," * @extends M.editor_atto.EditorPlugin"," */","Y.namespace('M.atto_wiris').Button = Y.Base.create('button', Y.M.editor_atto.EditorPlugin, [], {","","    initializer: function(config) {","","        // Filter not enabled at course level so no continue.","        if (!config.filter_enabled) {","            return;","        }","","        Y.Get.js(M.cfg.wwwroot + '/lib/editor/atto/plugins/wiris/core.js?v=' + config.version, function(err) {","            if (err) {","            } else {","                // Once the core is loaded we can extend the IntegrationModel class.","","                /**","                 * AttoIntegration constructor. Extends from IntegrationModel class.","                 * @param {object} integrationModelProperties - Integration model properties.","                 */","                var AttoIntegration = function(integrationModelProperties) {","                    WirisPlugin.IntegrationModel.call(this, integrationModelProperties);","                    this.config = integrationModelProperties.config;","                };","","                AttoIntegration.prototype = Object.create(WirisPlugin.IntegrationModel && WirisPlugin.IntegrationModel.prototype);","","","                /**","                 * Returns the absolute plugin path.","                 * @returns {string} - plugin path.","                 */","                AttoIntegration.prototype.getPath = function() {","                    return M.cfg.wwwroot + '/lib/editor/atto/plugins/wiris';","                };","","                /**","                 * Returns the integration language, i.e, Atto language","                 * @returns {string} - integration language.","                 */","                AttoIntegration.prototype.getLanguage = function() {","                    return this.config.lang;","                };","","                /**","                 * Handles a double click on the target element. In this integration","                 * we stop de event propagation to avoid Moodle opening image edit dialog.","                 * @param {object} element - DOM object target.","                 * @param {event} event - D¡double click event.","                 */","                AttoIntegration.prototype.doubleClickHandler = function(element, event) {","                    var isWirisformula = element.classList.contains('Wirisformula');","                    if (isWirisformula) {","                        event.stopPropagation();","                        WirisPlugin.IntegrationModel.prototype.doubleClickHandler.call(this, element, event);","                    }","                };","","                /**","                 * Converts a MathML to an image and insert the image in the DOM object. Once the","                 * formula is updated the edit object is marked as updated.","                 * @param {string} mathml - target MathML.","                 */","                AttoIntegration.prototype.updateFormula = function(mathml) {","                    WirisPlugin.IntegrationModel.prototype.updateFormula.call(this, mathml);","                    var host = this.editorObject.get('host');","                    var html = host.textarea.get('value');","                    var value = this.convertSafeMathml(WirisPlugin.Parser.endParse(html, null, this.config.lang, true));","                    host.textarea.set('value', value);","                    this.editorObject.markUpdated();","                };","","                /**","                 * Callback function. This function is called before 'onTargetReady' event","                 * is fired. We listen to form 'submit' event to un-parse the content.","                 */","                AttoIntegration.prototype.callbackFunction = function() {","                    WirisPlugin.IntegrationModel.prototype.callbackFunction.call(this);","                    this.parseContent();","                    // Adding submit event.","                    var form = this.editorObject.get('host').textarea.ancestor('form');","","                    if (form) {","                        form.on('submit', this.submit, this);","                    }","                };","","                /**","                 * Converts all MathML inside the editor object to img elements.","                 * **/","                AttoIntegration.prototype.parseContent = function() {","                    var host = this.editorObject.get('host');","                    var html = host.editor.get('innerHTML');","                    // Html = this._convertSafeMath(html);","                    html = WirisPlugin.Parser.initParse(html, this.config.lang);","                    host.editor.set('innerHTML', html);","                    this.editorObject.markUpdated();","                };","","                /**","                 * Converts all MathType images inside the editor object into MathML.","                 */","                AttoIntegration.prototype.unParseContent = function() {","                    var host = this.editorObject.get('host');","                    var html = host.textarea.get('value');","                    var value = this.convertSafeMathml(WirisPlugin.Parser.endParse(html, null, this.config.lang, true));","                    host.textarea.set('value', value);","                };","","                /**","                 * This method is called once the form is submitted. Replaces the content of the","                 * editor textarea replacing MathType formulas for the correspondent MathML.","                 */","                AttoIntegration.prototype.submit = function() {","                    var host = this.editorObject.get('host');","                    // We get the HTML content (with the imnages) instead of the raw html content","                    // and convert images into data-mathml attribute.","                    var html = host.editor.get('innerHTML');","                    // Check if exist mathml tag for parse.","                    if (html.indexOf('math»') >= 0 || html.indexOf('math>') >= 0 || html.indexOf('$$') >= 0) {","                        host.textarea.set('value', WirisPlugin.Parser.endParseSaveMode(html, null, this.config.lang, true));","                    }","                };","","                /**","                 * Transform all occurrences of safeMatML in a text for MathML.","                 * @param {string} content - original content.","                 * @returns {string} - parsed original content.","                 */","                AttoIntegration.prototype.convertSafeMathml = function(content) {","                   var output = '';","                   var mathTagBegin = '«math';","                   var mathTagEnd = '«/math»';","                   var start = content.indexOf(mathTagBegin);","                   var end = 0;","                   while (start != -1) {","                       output += content.substring(end, start);","                       // Avoid WIRIS images to be parsed.","                       imageMathmlAttribute = content.indexOf(WirisPlugin.Configuration.get('imageMathmlAttribute'));","                       end = content.indexOf(mathTagEnd, start);","","                       if (end == -1) {","                           end = content.length - 1;","                       } else if (imageMathmlAttribute != -1) {","                           // First close tag of img attribute","                           // If a mathmlAttribute exists should be inside a img tag.","                           end += content.indexOf(\"/>\", start);","                       } else {","                           end += mathTagEnd.length;","                       }","","                       if (!WirisPlugin.MathML.isMathmlInAttribute(content, start) && imageMathmlAttribute == -1) {","                           var mathml = content.substring(start, end);","                           output += WirisPlugin.MathML.safeXmlDecode(mathml);","                       } else {","                           output += content.substring(start, end);","                       }","","                       start = content.indexOf(mathTagBegin, end);","                   }","                   output += content.substring(end, content.length);","                   return output;","                };","","               /**","                * Integration model properties.","                * @type {object}","                * @property {string} configurationService - URL for configuration service.","                * @property {object} editorObject - editor object.","                * @property {object} target - integration DOM target.","                * @property {string} stringName - integration script name.","                * @property {object} config - Atto plugin config object.","                *","                */","                var integrationModelProperties = {};","                integrationModelProperties.configurationService = M.cfg.wwwroot + '/filter/wiris/integration/configurationjs.php';","                integrationModelProperties.editorObject = this;","                integrationModelProperties.target = this.get('host').editor.getDOMNode();","                integrationModelProperties.scriptName = '';","                integrationModelProperties.config = config;","                integrationModelProperties.version = 'unknown';","                integrationModelProperties.environment = {};","                integrationModelProperties.environment.editor = 'Atto';","                integrationModelProperties.environment.editorVersion = config.version;","                integrationModelProperties.environment.moodleCourse = config.moodleCourse;","","                // Here we create a new instance of AttoIntegration.","                var attoIntegrationInstance = new AttoIntegration(integrationModelProperties);","                attoIntegrationInstance.init();","                // We don't need to wait for anything. The event 'onTargetReady' can be fired.","                attoIntegrationInstance.listeners.fire('onTargetReady', {});","","                // Despite the number of Atto editors we only need a single instance.","                WirisPlugin.currentInstance = attoIntegrationInstance;","","                // We add the button after the collapse plugin initially hide other","                // buttons. So we recall it here.","                var host = this.get('host');","                if (host.plugins.collapse) {","                    host.plugins.collapse._setVisibility(host.plugins.collapse.buttons.collapse);","                }","            }","        }.bind(this));","","        this._addButtons(config);","","        // Global events to host.","        var host = this.get('host');","","        // It's needed to parse the content on selectionchanged event in order to recover properly","        // the content of the editor in drafts.","        // For more information view PLUGINS-1009","        host.on('atto:selectionchanged', function(e) {","            // This condition is satisfied when event is thrown by draft","            if (typeof e.event == 'undefined') {","                var html = host.editor.get('innerHTML');","                html = WirisPlugin.Parser.initParse(html, WirisPlugin.currentInstance.config.lang);","                host.editor.set('innerHTML', html);","            }","        });","","        // Override 'updateFromTextArea' to update the content editable element.","        // Inspired by: https://stackoverflow.com/a/16580937","        // Added error handling since it conflicts with multilang2 for Atto plugin","        // that uses this very same technique, https://moodle.org/plugins/atto_multilang2).","        host._wirisUpdateFromTextArea = host.updateFromTextArea;","        host.updateFromTextArea = function() {","            host._wirisUpdateFromTextArea();","            var html = host.editor.get('innerHTML');","            try {","                html = WirisPlugin.Parser.initParse(html, WirisPlugin.currentInstance.config.lang);","            } catch (error) {","            }","            host.editor.set('innerHTML', html);","        };","","        // Override 'updateOriginal' to update the content of the text area element.","        // Inspired by: https://stackoverflow.com/a/16580937","        // Added error handling since it conflicts with multilang2 for Atto plugin","        // that uses this very same technique, https://moodle.org/plugins/atto_multilang2).","        host._wirisupdateOriginal = host.updateOriginal;","        host.updateOriginal = function(mathtypeplugin) {","            host._wirisupdateOriginal();","            var value = host.textarea.get('value');","            try {","                value = WirisPlugin.Parser.endParse(value);","                value = mathtypeplugin._convertSafeMathML(value);","            } catch (error) {","            }","            host.textarea.set('value', value);","        };","","        /**","         * Converts all the occurrences of a safeMathml","         * with standard MathML.","         * @param {string} content content to be filtered.","         * @returns {string} the original content with MathML instead of safeMathML.","         */","        _convertSafeMathML = function(content) {","            var output = '';","            var mathTagBegin = '«math';","            var mathTagEnd = '«/math»';","            var start = content.indexOf(mathTagBegin);","            var end = 0;","","            while (start != -1) {","                output += content.substring(end, start);","                // Avoid WIRIS images to be parsed.","               imageMathmlAttribute = content.indexOf(WirisPlugin.Configuration.get('imageMathmlAttribute'));","                end = content.indexOf(mathTagEnd, start);","","                if (end == -1) {","                    end = content.length - 1;","                } else if (imageMathmlAttribute != -1) {","                    // First close tag of img attribute","                    // If a mathmlAttribute exists should be inside a img tag.","                    end += content.indexOf(\"/>\", start);","                } else {","                    end += mathTagEnd.length;","                }","","                if (!WirisPlugin.MathML.isMathmlInAttribute(content, start) && imageMathmlAttribute == -1) {","                    var mathml = content.substring(start, end);","                    output += WirisPlugin.MathML.safeXmlDecode(mathml);","                } else {","                    output += content.substring(start, end);","                }","","                start = content.indexOf(mathTagBegin, end);","            }","","            output += content.substring(end, content.length);","            return output;","        };","    },","","    /**","     * Add MathType and ChemType buttons to toolbar.","     * @param {object} config - backend configuration object.","     */","    _addButtons: function(config) {","        if (parseInt(config.editor_is_active)) {","            this.addButton({","                title: 'wiris_editor_title',","                buttonName: 'wiris_editor',","                icon: 'formula',","                iconComponent: 'atto_wiris',","                callback: this._editorButton","            });","        }","        if (parseInt(config.chemistry_is_active)) {","            this.addButton({","                title: 'wiris_chem_editor_title',","                buttonName: 'wiris_chem_editor',","                icon: 'chem',","                iconComponent: 'atto_wiris',","                callback: this._chemButton","            });","        }","    },","    /**","     * Callback for MathType button.","     */","    _editorButton: function() {","        WirisPlugin.currentInstance.editorObject = this;","        WirisPlugin.currentInstance.setTarget(this.get('host').editor.getDOMNode());","        WirisPlugin.currentInstance.core.getCustomEditors().disable();","        WirisPlugin.currentInstance.openNewFormulaEditor();","    },","    /**","     * Callback for ChemType button.","     */","    _chemButton: function() {","        WirisPlugin.currentInstance.editorObject = this;","        WirisPlugin.currentInstance.setTarget(this.get('host').editor.getDOMNode());","        WirisPlugin.currentInstance.getCore().getCustomEditors().enable('chemistry');","        WirisPlugin.currentInstance.openNewFormulaEditor();","    }","});","","","}, '@VERSION@', {\"requires\": [\"moodle-editor_atto-plugin\", \"get\"]});","","}());"]};
}
var __cov_tmnBBUj0CNil5kr31llMCw = __coverage__['build/moodle-atto_wiris-button/moodle-atto_wiris-button.js'];
__cov_tmnBBUj0CNil5kr31llMCw.s['1']++;YUI.add('moodle-atto_wiris-button',function(Y,NAME){__cov_tmnBBUj0CNil5kr31llMCw.f['1']++;__cov_tmnBBUj0CNil5kr31llMCw.s['2']++;Y.namespace('M.atto_wiris').Button=Y.Base.create('button',Y.M.editor_atto.EditorPlugin,[],{initializer:function(config){__cov_tmnBBUj0CNil5kr31llMCw.f['2']++;__cov_tmnBBUj0CNil5kr31llMCw.s['3']++;if(!config.filter_enabled){__cov_tmnBBUj0CNil5kr31llMCw.b['1'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['4']++;return;}else{__cov_tmnBBUj0CNil5kr31llMCw.b['1'][1]++;}__cov_tmnBBUj0CNil5kr31llMCw.s['5']++;Y.Get.js(M.cfg.wwwroot+'/lib/editor/atto/plugins/wiris/core.js?v='+config.version,function(err){__cov_tmnBBUj0CNil5kr31llMCw.f['3']++;__cov_tmnBBUj0CNil5kr31llMCw.s['6']++;if(err){__cov_tmnBBUj0CNil5kr31llMCw.b['2'][0]++;}else{__cov_tmnBBUj0CNil5kr31llMCw.b['2'][1]++;__cov_tmnBBUj0CNil5kr31llMCw.s['7']++;var AttoIntegration=function(integrationModelProperties){__cov_tmnBBUj0CNil5kr31llMCw.f['4']++;__cov_tmnBBUj0CNil5kr31llMCw.s['8']++;WirisPlugin.IntegrationModel.call(this,integrationModelProperties);__cov_tmnBBUj0CNil5kr31llMCw.s['9']++;this.config=integrationModelProperties.config;};__cov_tmnBBUj0CNil5kr31llMCw.s['10']++;AttoIntegration.prototype=Object.create((__cov_tmnBBUj0CNil5kr31llMCw.b['3'][0]++,WirisPlugin.IntegrationModel)&&(__cov_tmnBBUj0CNil5kr31llMCw.b['3'][1]++,WirisPlugin.IntegrationModel.prototype));__cov_tmnBBUj0CNil5kr31llMCw.s['11']++;AttoIntegration.prototype.getPath=function(){__cov_tmnBBUj0CNil5kr31llMCw.f['5']++;__cov_tmnBBUj0CNil5kr31llMCw.s['12']++;return M.cfg.wwwroot+'/lib/editor/atto/plugins/wiris';};__cov_tmnBBUj0CNil5kr31llMCw.s['13']++;AttoIntegration.prototype.getLanguage=function(){__cov_tmnBBUj0CNil5kr31llMCw.f['6']++;__cov_tmnBBUj0CNil5kr31llMCw.s['14']++;return this.config.lang;};__cov_tmnBBUj0CNil5kr31llMCw.s['15']++;AttoIntegration.prototype.doubleClickHandler=function(element,event){__cov_tmnBBUj0CNil5kr31llMCw.f['7']++;__cov_tmnBBUj0CNil5kr31llMCw.s['16']++;var isWirisformula=element.classList.contains('Wirisformula');__cov_tmnBBUj0CNil5kr31llMCw.s['17']++;if(isWirisformula){__cov_tmnBBUj0CNil5kr31llMCw.b['4'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['18']++;event.stopPropagation();__cov_tmnBBUj0CNil5kr31llMCw.s['19']++;WirisPlugin.IntegrationModel.prototype.doubleClickHandler.call(this,element,event);}else{__cov_tmnBBUj0CNil5kr31llMCw.b['4'][1]++;}};__cov_tmnBBUj0CNil5kr31llMCw.s['20']++;AttoIntegration.prototype.updateFormula=function(mathml){__cov_tmnBBUj0CNil5kr31llMCw.f['8']++;__cov_tmnBBUj0CNil5kr31llMCw.s['21']++;WirisPlugin.IntegrationModel.prototype.updateFormula.call(this,mathml);__cov_tmnBBUj0CNil5kr31llMCw.s['22']++;var host=this.editorObject.get('host');__cov_tmnBBUj0CNil5kr31llMCw.s['23']++;var html=host.textarea.get('value');__cov_tmnBBUj0CNil5kr31llMCw.s['24']++;var value=this.convertSafeMathml(WirisPlugin.Parser.endParse(html,null,this.config.lang,true));__cov_tmnBBUj0CNil5kr31llMCw.s['25']++;host.textarea.set('value',value);__cov_tmnBBUj0CNil5kr31llMCw.s['26']++;this.editorObject.markUpdated();};__cov_tmnBBUj0CNil5kr31llMCw.s['27']++;AttoIntegration.prototype.callbackFunction=function(){__cov_tmnBBUj0CNil5kr31llMCw.f['9']++;__cov_tmnBBUj0CNil5kr31llMCw.s['28']++;WirisPlugin.IntegrationModel.prototype.callbackFunction.call(this);__cov_tmnBBUj0CNil5kr31llMCw.s['29']++;this.parseContent();__cov_tmnBBUj0CNil5kr31llMCw.s['30']++;var form=this.editorObject.get('host').textarea.ancestor('form');__cov_tmnBBUj0CNil5kr31llMCw.s['31']++;if(form){__cov_tmnBBUj0CNil5kr31llMCw.b['5'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['32']++;form.on('submit',this.submit,this);}else{__cov_tmnBBUj0CNil5kr31llMCw.b['5'][1]++;}};__cov_tmnBBUj0CNil5kr31llMCw.s['33']++;AttoIntegration.prototype.parseContent=function(){__cov_tmnBBUj0CNil5kr31llMCw.f['10']++;__cov_tmnBBUj0CNil5kr31llMCw.s['34']++;var host=this.editorObject.get('host');__cov_tmnBBUj0CNil5kr31llMCw.s['35']++;var html=host.editor.get('innerHTML');__cov_tmnBBUj0CNil5kr31llMCw.s['36']++;html=WirisPlugin.Parser.initParse(html,this.config.lang);__cov_tmnBBUj0CNil5kr31llMCw.s['37']++;host.editor.set('innerHTML',html);__cov_tmnBBUj0CNil5kr31llMCw.s['38']++;this.editorObject.markUpdated();};__cov_tmnBBUj0CNil5kr31llMCw.s['39']++;AttoIntegration.prototype.unParseContent=function(){__cov_tmnBBUj0CNil5kr31llMCw.f['11']++;__cov_tmnBBUj0CNil5kr31llMCw.s['40']++;var host=this.editorObject.get('host');__cov_tmnBBUj0CNil5kr31llMCw.s['41']++;var html=host.textarea.get('value');__cov_tmnBBUj0CNil5kr31llMCw.s['42']++;var value=this.convertSafeMathml(WirisPlugin.Parser.endParse(html,null,this.config.lang,true));__cov_tmnBBUj0CNil5kr31llMCw.s['43']++;host.textarea.set('value',value);};__cov_tmnBBUj0CNil5kr31llMCw.s['44']++;AttoIntegration.prototype.submit=function(){__cov_tmnBBUj0CNil5kr31llMCw.f['12']++;__cov_tmnBBUj0CNil5kr31llMCw.s['45']++;var host=this.editorObject.get('host');__cov_tmnBBUj0CNil5kr31llMCw.s['46']++;var html=host.editor.get('innerHTML');__cov_tmnBBUj0CNil5kr31llMCw.s['47']++;if((__cov_tmnBBUj0CNil5kr31llMCw.b['7'][0]++,html.indexOf('math\xbb')>=0)||(__cov_tmnBBUj0CNil5kr31llMCw.b['7'][1]++,html.indexOf('math>')>=0)||(__cov_tmnBBUj0CNil5kr31llMCw.b['7'][2]++,html.indexOf('$$')>=0)){__cov_tmnBBUj0CNil5kr31llMCw.b['6'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['48']++;host.textarea.set('value',WirisPlugin.Parser.endParseSaveMode(html,null,this.config.lang,true));}else{__cov_tmnBBUj0CNil5kr31llMCw.b['6'][1]++;}};__cov_tmnBBUj0CNil5kr31llMCw.s['49']++;AttoIntegration.prototype.convertSafeMathml=function(content){__cov_tmnBBUj0CNil5kr31llMCw.f['13']++;__cov_tmnBBUj0CNil5kr31llMCw.s['50']++;var output='';__cov_tmnBBUj0CNil5kr31llMCw.s['51']++;var mathTagBegin='\xabmath';__cov_tmnBBUj0CNil5kr31llMCw.s['52']++;var mathTagEnd='\xab/math\xbb';__cov_tmnBBUj0CNil5kr31llMCw.s['53']++;var start=content.indexOf(mathTagBegin);__cov_tmnBBUj0CNil5kr31llMCw.s['54']++;var end=0;__cov_tmnBBUj0CNil5kr31llMCw.s['55']++;while(start!=-1){__cov_tmnBBUj0CNil5kr31llMCw.s['56']++;output+=content.substring(end,start);__cov_tmnBBUj0CNil5kr31llMCw.s['57']++;imageMathmlAttribute=content.indexOf(WirisPlugin.Configuration.get('imageMathmlAttribute'));__cov_tmnBBUj0CNil5kr31llMCw.s['58']++;end=content.indexOf(mathTagEnd,start);__cov_tmnBBUj0CNil5kr31llMCw.s['59']++;if(end==-1){__cov_tmnBBUj0CNil5kr31llMCw.b['8'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['60']++;end=content.length-1;}else{__cov_tmnBBUj0CNil5kr31llMCw.b['8'][1]++;__cov_tmnBBUj0CNil5kr31llMCw.s['61']++;if(imageMathmlAttribute!=-1){__cov_tmnBBUj0CNil5kr31llMCw.b['9'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['62']++;end+=content.indexOf('/>',start);}else{__cov_tmnBBUj0CNil5kr31llMCw.b['9'][1]++;__cov_tmnBBUj0CNil5kr31llMCw.s['63']++;end+=mathTagEnd.length;}}__cov_tmnBBUj0CNil5kr31llMCw.s['64']++;if((__cov_tmnBBUj0CNil5kr31llMCw.b['11'][0]++,!WirisPlugin.MathML.isMathmlInAttribute(content,start))&&(__cov_tmnBBUj0CNil5kr31llMCw.b['11'][1]++,imageMathmlAttribute==-1)){__cov_tmnBBUj0CNil5kr31llMCw.b['10'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['65']++;var mathml=content.substring(start,end);__cov_tmnBBUj0CNil5kr31llMCw.s['66']++;output+=WirisPlugin.MathML.safeXmlDecode(mathml);}else{__cov_tmnBBUj0CNil5kr31llMCw.b['10'][1]++;__cov_tmnBBUj0CNil5kr31llMCw.s['67']++;output+=content.substring(start,end);}__cov_tmnBBUj0CNil5kr31llMCw.s['68']++;start=content.indexOf(mathTagBegin,end);}__cov_tmnBBUj0CNil5kr31llMCw.s['69']++;output+=content.substring(end,content.length);__cov_tmnBBUj0CNil5kr31llMCw.s['70']++;return output;};__cov_tmnBBUj0CNil5kr31llMCw.s['71']++;var integrationModelProperties={};__cov_tmnBBUj0CNil5kr31llMCw.s['72']++;integrationModelProperties.configurationService=M.cfg.wwwroot+'/filter/wiris/integration/configurationjs.php';__cov_tmnBBUj0CNil5kr31llMCw.s['73']++;integrationModelProperties.editorObject=this;__cov_tmnBBUj0CNil5kr31llMCw.s['74']++;integrationModelProperties.target=this.get('host').editor.getDOMNode();__cov_tmnBBUj0CNil5kr31llMCw.s['75']++;integrationModelProperties.scriptName='';__cov_tmnBBUj0CNil5kr31llMCw.s['76']++;integrationModelProperties.config=config;__cov_tmnBBUj0CNil5kr31llMCw.s['77']++;integrationModelProperties.version='unknown';__cov_tmnBBUj0CNil5kr31llMCw.s['78']++;integrationModelProperties.environment={};__cov_tmnBBUj0CNil5kr31llMCw.s['79']++;integrationModelProperties.environment.editor='Atto';__cov_tmnBBUj0CNil5kr31llMCw.s['80']++;integrationModelProperties.environment.editorVersion=config.version;__cov_tmnBBUj0CNil5kr31llMCw.s['81']++;integrationModelProperties.environment.moodleCourse=config.moodleCourse;__cov_tmnBBUj0CNil5kr31llMCw.s['82']++;var attoIntegrationInstance=new AttoIntegration(integrationModelProperties);__cov_tmnBBUj0CNil5kr31llMCw.s['83']++;attoIntegrationInstance.init();__cov_tmnBBUj0CNil5kr31llMCw.s['84']++;attoIntegrationInstance.listeners.fire('onTargetReady',{});__cov_tmnBBUj0CNil5kr31llMCw.s['85']++;WirisPlugin.currentInstance=attoIntegrationInstance;__cov_tmnBBUj0CNil5kr31llMCw.s['86']++;var host=this.get('host');__cov_tmnBBUj0CNil5kr31llMCw.s['87']++;if(host.plugins.collapse){__cov_tmnBBUj0CNil5kr31llMCw.b['12'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['88']++;host.plugins.collapse._setVisibility(host.plugins.collapse.buttons.collapse);}else{__cov_tmnBBUj0CNil5kr31llMCw.b['12'][1]++;}}}.bind(this));__cov_tmnBBUj0CNil5kr31llMCw.s['89']++;this._addButtons(config);__cov_tmnBBUj0CNil5kr31llMCw.s['90']++;var host=this.get('host');__cov_tmnBBUj0CNil5kr31llMCw.s['91']++;host.on('atto:selectionchanged',function(e){__cov_tmnBBUj0CNil5kr31llMCw.f['14']++;__cov_tmnBBUj0CNil5kr31llMCw.s['92']++;if(typeof e.event=='undefined'){__cov_tmnBBUj0CNil5kr31llMCw.b['13'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['93']++;var html=host.editor.get('innerHTML');__cov_tmnBBUj0CNil5kr31llMCw.s['94']++;html=WirisPlugin.Parser.initParse(html,WirisPlugin.currentInstance.config.lang);__cov_tmnBBUj0CNil5kr31llMCw.s['95']++;host.editor.set('innerHTML',html);}else{__cov_tmnBBUj0CNil5kr31llMCw.b['13'][1]++;}});__cov_tmnBBUj0CNil5kr31llMCw.s['96']++;host._wirisUpdateFromTextArea=host.updateFromTextArea;__cov_tmnBBUj0CNil5kr31llMCw.s['97']++;host.updateFromTextArea=function(){__cov_tmnBBUj0CNil5kr31llMCw.f['15']++;__cov_tmnBBUj0CNil5kr31llMCw.s['98']++;host._wirisUpdateFromTextArea();__cov_tmnBBUj0CNil5kr31llMCw.s['99']++;var html=host.editor.get('innerHTML');__cov_tmnBBUj0CNil5kr31llMCw.s['100']++;try{__cov_tmnBBUj0CNil5kr31llMCw.s['101']++;html=WirisPlugin.Parser.initParse(html,WirisPlugin.currentInstance.config.lang);}catch(error){}__cov_tmnBBUj0CNil5kr31llMCw.s['102']++;host.editor.set('innerHTML',html);};__cov_tmnBBUj0CNil5kr31llMCw.s['103']++;host._wirisupdateOriginal=host.updateOriginal;__cov_tmnBBUj0CNil5kr31llMCw.s['104']++;host.updateOriginal=function(mathtypeplugin){__cov_tmnBBUj0CNil5kr31llMCw.f['16']++;__cov_tmnBBUj0CNil5kr31llMCw.s['105']++;host._wirisupdateOriginal();__cov_tmnBBUj0CNil5kr31llMCw.s['106']++;var value=host.textarea.get('value');__cov_tmnBBUj0CNil5kr31llMCw.s['107']++;try{__cov_tmnBBUj0CNil5kr31llMCw.s['108']++;value=WirisPlugin.Parser.endParse(value);__cov_tmnBBUj0CNil5kr31llMCw.s['109']++;value=mathtypeplugin._convertSafeMathML(value);}catch(error){}__cov_tmnBBUj0CNil5kr31llMCw.s['110']++;host.textarea.set('value',value);};__cov_tmnBBUj0CNil5kr31llMCw.s['111']++;_convertSafeMathML=function(content){__cov_tmnBBUj0CNil5kr31llMCw.f['17']++;__cov_tmnBBUj0CNil5kr31llMCw.s['112']++;var output='';__cov_tmnBBUj0CNil5kr31llMCw.s['113']++;var mathTagBegin='\xabmath';__cov_tmnBBUj0CNil5kr31llMCw.s['114']++;var mathTagEnd='\xab/math\xbb';__cov_tmnBBUj0CNil5kr31llMCw.s['115']++;var start=content.indexOf(mathTagBegin);__cov_tmnBBUj0CNil5kr31llMCw.s['116']++;var end=0;__cov_tmnBBUj0CNil5kr31llMCw.s['117']++;while(start!=-1){__cov_tmnBBUj0CNil5kr31llMCw.s['118']++;output+=content.substring(end,start);__cov_tmnBBUj0CNil5kr31llMCw.s['119']++;imageMathmlAttribute=content.indexOf(WirisPlugin.Configuration.get('imageMathmlAttribute'));__cov_tmnBBUj0CNil5kr31llMCw.s['120']++;end=content.indexOf(mathTagEnd,start);__cov_tmnBBUj0CNil5kr31llMCw.s['121']++;if(end==-1){__cov_tmnBBUj0CNil5kr31llMCw.b['14'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['122']++;end=content.length-1;}else{__cov_tmnBBUj0CNil5kr31llMCw.b['14'][1]++;__cov_tmnBBUj0CNil5kr31llMCw.s['123']++;if(imageMathmlAttribute!=-1){__cov_tmnBBUj0CNil5kr31llMCw.b['15'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['124']++;end+=content.indexOf('/>',start);}else{__cov_tmnBBUj0CNil5kr31llMCw.b['15'][1]++;__cov_tmnBBUj0CNil5kr31llMCw.s['125']++;end+=mathTagEnd.length;}}__cov_tmnBBUj0CNil5kr31llMCw.s['126']++;if((__cov_tmnBBUj0CNil5kr31llMCw.b['17'][0]++,!WirisPlugin.MathML.isMathmlInAttribute(content,start))&&(__cov_tmnBBUj0CNil5kr31llMCw.b['17'][1]++,imageMathmlAttribute==-1)){__cov_tmnBBUj0CNil5kr31llMCw.b['16'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['127']++;var mathml=content.substring(start,end);__cov_tmnBBUj0CNil5kr31llMCw.s['128']++;output+=WirisPlugin.MathML.safeXmlDecode(mathml);}else{__cov_tmnBBUj0CNil5kr31llMCw.b['16'][1]++;__cov_tmnBBUj0CNil5kr31llMCw.s['129']++;output+=content.substring(start,end);}__cov_tmnBBUj0CNil5kr31llMCw.s['130']++;start=content.indexOf(mathTagBegin,end);}__cov_tmnBBUj0CNil5kr31llMCw.s['131']++;output+=content.substring(end,content.length);__cov_tmnBBUj0CNil5kr31llMCw.s['132']++;return output;};},_addButtons:function(config){__cov_tmnBBUj0CNil5kr31llMCw.f['18']++;__cov_tmnBBUj0CNil5kr31llMCw.s['133']++;if(parseInt(config.editor_is_active)){__cov_tmnBBUj0CNil5kr31llMCw.b['18'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['134']++;this.addButton({title:'wiris_editor_title',buttonName:'wiris_editor',icon:'formula',iconComponent:'atto_wiris',callback:this._editorButton});}else{__cov_tmnBBUj0CNil5kr31llMCw.b['18'][1]++;}__cov_tmnBBUj0CNil5kr31llMCw.s['135']++;if(parseInt(config.chemistry_is_active)){__cov_tmnBBUj0CNil5kr31llMCw.b['19'][0]++;__cov_tmnBBUj0CNil5kr31llMCw.s['136']++;this.addButton({title:'wiris_chem_editor_title',buttonName:'wiris_chem_editor',icon:'chem',iconComponent:'atto_wiris',callback:this._chemButton});}else{__cov_tmnBBUj0CNil5kr31llMCw.b['19'][1]++;}},_editorButton:function(){__cov_tmnBBUj0CNil5kr31llMCw.f['19']++;__cov_tmnBBUj0CNil5kr31llMCw.s['137']++;WirisPlugin.currentInstance.editorObject=this;__cov_tmnBBUj0CNil5kr31llMCw.s['138']++;WirisPlugin.currentInstance.setTarget(this.get('host').editor.getDOMNode());__cov_tmnBBUj0CNil5kr31llMCw.s['139']++;WirisPlugin.currentInstance.core.getCustomEditors().disable();__cov_tmnBBUj0CNil5kr31llMCw.s['140']++;WirisPlugin.currentInstance.openNewFormulaEditor();},_chemButton:function(){__cov_tmnBBUj0CNil5kr31llMCw.f['20']++;__cov_tmnBBUj0CNil5kr31llMCw.s['141']++;WirisPlugin.currentInstance.editorObject=this;__cov_tmnBBUj0CNil5kr31llMCw.s['142']++;WirisPlugin.currentInstance.setTarget(this.get('host').editor.getDOMNode());__cov_tmnBBUj0CNil5kr31llMCw.s['143']++;WirisPlugin.currentInstance.getCore().getCustomEditors().enable('chemistry');__cov_tmnBBUj0CNil5kr31llMCw.s['144']++;WirisPlugin.currentInstance.openNewFormulaEditor();}});},'@VERSION@',{'requires':['moodle-editor_atto-plugin','get']});
